<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google OR-Tools: operations_research::sat::ObjectiveEncoder Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="orLogo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Google OR-Tools<span id="projectnumber">&#160;v9.9</span>
   </div>
   <div id="projectbrief">a fast and portable software suite for combinatorial optimization</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classoperations__research_1_1sat_1_1ObjectiveEncoder.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classoperations__research_1_1sat_1_1ObjectiveEncoder-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">operations_research::sat::ObjectiveEncoder Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="encoding_8h_source.html">encoding.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a594dd682d98e58994d6a47d558c63290" id="r_a594dd682d98e58994d6a47d558c63290"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a594dd682d98e58994d6a47d558c63290">ObjectiveEncoder</a> (<a class="el" href="classoperations__research_1_1sat_1_1Model.html">Model</a> *<a class="el" href="gurobi__interface_8cc.html#a0728f23c9a47655d38e0bf1a2f200bcf">model</a>)</td></tr>
<tr class="separator:a594dd682d98e58994d6a47d558c63290"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea57787b48ca659a4962d5b674a72762" id="r_aea57787b48ca659a4962d5b674a72762"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aea57787b48ca659a4962d5b674a72762">ProcessCore</a> (absl::Span&lt; const <a class="el" href="classoperations__research_1_1sat_1_1Literal.html">Literal</a> &gt; core, Coefficient min_weight, Coefficient gap, std::string *info)</td></tr>
<tr class="separator:aea57787b48ca659a4962d5b674a72762"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b33d5c9b6fde2e556584121c674a872" id="r_a8b33d5c9b6fde2e556584121c674a872"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8b33d5c9b6fde2e556584121c674a872">AddBaseNode</a> (<a class="el" href="classoperations__research_1_1sat_1_1EncodingNode.html">EncodingNode</a> node)</td></tr>
<tr class="separator:a8b33d5c9b6fde2e556584121c674a872"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba8bf46b2a10fabd82ffd3dbf2f0e174" id="r_aba8bf46b2a10fabd82ffd3dbf2f0e174"><td class="memItemLeft" align="right" valign="top">const std::vector&lt; <a class="el" href="classoperations__research_1_1sat_1_1EncodingNode.html">EncodingNode</a> * &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aba8bf46b2a10fabd82ffd3dbf2f0e174">nodes</a> () const</td></tr>
<tr class="separator:aba8bf46b2a10fabd82ffd3dbf2f0e174"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b4788e4a407d84241c915ba24a79c30" id="r_a2b4788e4a407d84241c915ba24a79c30"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classoperations__research_1_1sat_1_1EncodingNode.html">EncodingNode</a> * &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2b4788e4a407d84241c915ba24a79c30">mutable_nodes</a> ()</td></tr>
<tr class="separator:a2b4788e4a407d84241c915ba24a79c30"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The class reponsible for processing cores and maintaining a Boolean encoding of the linear objective. </p>

<p class="definition">Definition at line <a class="el" href="encoding_8h_source.html#l00232">232</a> of file <a class="el" href="encoding_8h_source.html">encoding.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a594dd682d98e58994d6a47d558c63290" name="a594dd682d98e58994d6a47d558c63290"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a594dd682d98e58994d6a47d558c63290">&#9670;&#160;</a></span>ObjectiveEncoder()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">operations_research::sat::ObjectiveEncoder::ObjectiveEncoder </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classoperations__research_1_1sat_1_1Model.html">Model</a> *</td>          <td class="paramname"><span class="paramname"><em>model</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="encoding_8h_source.html#l00234">234</a> of file <a class="el" href="encoding_8h_source.html">encoding.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a8b33d5c9b6fde2e556584121c674a872" name="a8b33d5c9b6fde2e556584121c674a872"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b33d5c9b6fde2e556584121c674a872">&#9670;&#160;</a></span>AddBaseNode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void operations_research::sat::ObjectiveEncoder::AddBaseNode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classoperations__research_1_1sat_1_1EncodingNode.html">EncodingNode</a></td>          <td class="paramname"><span class="paramname"><em>node</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="encoding_8h_source.html#l00245">245</a> of file <a class="el" href="encoding_8h_source.html">encoding.h</a>.</p>

</div>
</div>
<a id="a2b4788e4a407d84241c915ba24a79c30" name="a2b4788e4a407d84241c915ba24a79c30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b4788e4a407d84241c915ba24a79c30">&#9670;&#160;</a></span>mutable_nodes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classoperations__research_1_1sat_1_1EncodingNode.html">EncodingNode</a> * &gt; * operations_research::sat::ObjectiveEncoder::mutable_nodes </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="encoding_8h_source.html#l00252">252</a> of file <a class="el" href="encoding_8h_source.html">encoding.h</a>.</p>

</div>
</div>
<a id="aba8bf46b2a10fabd82ffd3dbf2f0e174" name="aba8bf46b2a10fabd82ffd3dbf2f0e174"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba8bf46b2a10fabd82ffd3dbf2f0e174">&#9670;&#160;</a></span>nodes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::vector&lt; <a class="el" href="classoperations__research_1_1sat_1_1EncodingNode.html">EncodingNode</a> * &gt; &amp; operations_research::sat::ObjectiveEncoder::nodes </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001619">Todo</a></b></dt><dd>(user): Remove mutable version once refactoring is done. </dd></dl>

<p class="definition">Definition at line <a class="el" href="encoding_8h_source.html#l00251">251</a> of file <a class="el" href="encoding_8h_source.html">encoding.h</a>.</p>

</div>
</div>
<a id="aea57787b48ca659a4962d5b674a72762" name="aea57787b48ca659a4962d5b674a72762"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea57787b48ca659a4962d5b674a72762">&#9670;&#160;</a></span>ProcessCore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool operations_research::sat::ObjectiveEncoder::ProcessCore </td>
          <td>(</td>
          <td class="paramtype">absl::Span&lt; const <a class="el" href="classoperations__research_1_1sat_1_1Literal.html">Literal</a> &gt;</td>          <td class="paramname"><span class="paramname"><em>core</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Coefficient</td>          <td class="paramname"><span class="paramname"><em>min_weight</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Coefficient</td>          <td class="paramname"><span class="paramname"><em>gap</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string *</td>          <td class="paramname"><span class="paramname"><em>info</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Updates the encoding using the given core. The literals in the core must match the order in nodes. Returns false if the model become infeasible. </p>
<p>Backtrack to be able to add new constraints.</p>
<p>Remove from nodes the <a class="el" href="classoperations__research_1_1sat_1_1EncodingNode.html">EncodingNode</a> in the core and put them in to_merge.</p>
<p>Since the nodes appear in order in the core, we can find the relevant "objective" variable efficiently with a simple linear scan in the nodes vector (done with index).</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001615">Todo</a></b></dt><dd>(user): propagate proper ub first. </dd></dl>
<p>We can distinguish the first literal of the node. By not counting its weight in node, and creating a new node for it.</p>
<p>Now keep processing with this new node instead.</p>
<p>Special case if the weight &gt; min_weight. we keep it, but reduce its cost. This is the same "trick" as in WPM1 used to deal with weight. We basically split a clause with a larger weight in two identical clauses, one with weight min_weight that will be merged and one with the remaining weight.</p>
<p>Are the literal in amo relationship?</p><ul>
<li>If min_weight is large enough, we can infer that.</li>
<li>If the size is small we can infer this via propagation.</li>
</ul>
<p>Amongst the node to merge, if many are boolean nodes in an "at most one" relationship, it is super advantageous to exploit it during merging as we can regroup all nodes from an at most one in a single new node with a depth of 1.</p>
<p>Collect "boolean nodes".</p>
<p>For "small" core, with O(n) full propagation, we can discover possible at most ones. This is a bit costly but can significantly reduce the number of Booleans needed and has a good positive impact.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001616">Todo</a></b></dt><dd>(user): this node is closed and can be removed from the core. </dd></dl>
<p>Unit propagation is not always symmetric.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001617">Todo</a></b></dt><dd>(user): If assignment.LiteralIsTrue(bool_nodes[j]) We can minimize the core here by removing bool_nodes[i] from it. Note however that since we already minimized the core, this is unlikely to happen. </dd></dl>
<p>Convert.</p>
<p>Same case as above, all the nodes in the core are in a exactly_one.</p>
<p>Extract Amo nodes and set them to nullptr in to_merge.</p>
<p>Create the new node with proper constraints and weight.</p>
<p>Clean-up to_merge.</p>
<p>If all the literal of the core are in at_most_one, the core is actually an exactly_one. We just subtracted the min_cost above. We just have to enqueue a constant node with min_weight for the rest of the code to work.</p>
<p>Tricky: We need to enforce an upper bound of 1 on the nodes.</p>
<p>The negation of the literal in the core are in exactly one. </p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo001618">Todo</a></b></dt><dd>(user): If we infered the exactly one from the binary implication graph, there is no need to add the amo since it is already there. </dd></dl>

<p class="definition">Definition at line <a class="el" href="encoding_8cc_source.html#l00586">586</a> of file <a class="el" href="encoding_8cc_source.html">encoding.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>ortools/sat/<a class="el" href="encoding_8h_source.html">encoding.h</a></li>
<li>ortools/sat/<a class="el" href="encoding_8cc_source.html">encoding.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceoperations__research.html">operations_research</a></li><li class="navelem"><a class="el" href="namespaceoperations__research_1_1sat.html">sat</a></li><li class="navelem"><a class="el" href="classoperations__research_1_1sat_1_1ObjectiveEncoder.html">ObjectiveEncoder</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
