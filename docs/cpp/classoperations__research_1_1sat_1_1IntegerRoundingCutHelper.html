<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google OR-Tools: operations_research::sat::IntegerRoundingCutHelper Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="orLogo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Google OR-Tools<span id="projectnumber">&#160;v9.11</span>
   </div>
   <div id="projectbrief">a fast and portable software suite for combinatorial optimization</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classoperations__research_1_1sat_1_1IntegerRoundingCutHelper.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classoperations__research_1_1sat_1_1IntegerRoundingCutHelper-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">operations_research::sat::IntegerRoundingCutHelper Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="cuts_8h_source.html">cuts.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a19ff9baa6e0092b883404bb00929e4fa" id="r_a19ff9baa6e0092b883404bb00929e4fa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a19ff9baa6e0092b883404bb00929e4fa">~IntegerRoundingCutHelper</a> ()</td></tr>
<tr class="separator:a19ff9baa6e0092b883404bb00929e4fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55348bee0f2fe5505e28cc64ddfb1404" id="r_a55348bee0f2fe5505e28cc64ddfb1404"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a55348bee0f2fe5505e28cc64ddfb1404">ComputeCut</a> (<a class="el" href="structoperations__research_1_1sat_1_1RoundingOptions.html">RoundingOptions</a> options, const <a class="el" href="structoperations__research_1_1sat_1_1CutData.html">CutData</a> &amp;base_ct, <a class="el" href="classoperations__research_1_1sat_1_1ImpliedBoundsProcessor.html">ImpliedBoundsProcessor</a> *ib_processor=nullptr)</td></tr>
<tr class="memdesc:a55348bee0f2fe5505e28cc64ddfb1404"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true on success. The cut can be accessed via <a class="el" href="#a58d0dc825ac4d94daee28062423208e3" title="If successful, info about the last generated cut.">cut()</a>.  <br /></td></tr>
<tr class="separator:a55348bee0f2fe5505e28cc64ddfb1404"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58d0dc825ac4d94daee28062423208e3" id="r_a58d0dc825ac4d94daee28062423208e3"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structoperations__research_1_1sat_1_1CutData.html">CutData</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a58d0dc825ac4d94daee28062423208e3">cut</a> () const</td></tr>
<tr class="memdesc:a58d0dc825ac4d94daee28062423208e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">If successful, info about the last generated cut.  <br /></td></tr>
<tr class="separator:a58d0dc825ac4d94daee28062423208e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaa0b7331e762ee55e778a96fd5b1da7" id="r_afaa0b7331e762ee55e778a96fd5b1da7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afaa0b7331e762ee55e778a96fd5b1da7">SetSharedStatistics</a> (<a class="el" href="classoperations__research_1_1sat_1_1SharedStatistics.html">SharedStatistics</a> *stats)</td></tr>
<tr class="separator:afaa0b7331e762ee55e778a96fd5b1da7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60f3292cb1422998fb1f3cceb3bf4979" id="r_a60f3292cb1422998fb1f3cceb3bf4979"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a60f3292cb1422998fb1f3cceb3bf4979">Info</a> () const</td></tr>
<tr class="memdesc:a60f3292cb1422998fb1f3cceb3bf4979"><td class="mdescLeft">&#160;</td><td class="mdescRight">Single line of text that we append to the cut log line.  <br /></td></tr>
<tr class="separator:a60f3292cb1422998fb1f3cceb3bf4979"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="cuts_8h_source.html#l00406">406</a> of file <a class="el" href="cuts_8h_source.html">cuts.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a19ff9baa6e0092b883404bb00929e4fa" name="a19ff9baa6e0092b883404bb00929e4fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19ff9baa6e0092b883404bb00929e4fa">&#9670;&#160;</a></span>~IntegerRoundingCutHelper()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">operations_research::sat::IntegerRoundingCutHelper::~IntegerRoundingCutHelper </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cuts_8cc_source.html#l00646">646</a> of file <a class="el" href="cuts_8cc_source.html">cuts.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a55348bee0f2fe5505e28cc64ddfb1404" name="a55348bee0f2fe5505e28cc64ddfb1404"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55348bee0f2fe5505e28cc64ddfb1404">&#9670;&#160;</a></span>ComputeCut()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool operations_research::sat::IntegerRoundingCutHelper::ComputeCut </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structoperations__research_1_1sat_1_1RoundingOptions.html">RoundingOptions</a></td>          <td class="paramname"><span class="paramname"><em>options</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structoperations__research_1_1sat_1_1CutData.html">CutData</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>base_ct</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classoperations__research_1_1sat_1_1ImpliedBoundsProcessor.html">ImpliedBoundsProcessor</a> *</td>          <td class="paramname"><span class="paramname"><em>ib_processor</em></span><span class="paramdefsep"> = </span><span class="paramdefval">nullptr</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true on success. The cut can be accessed via <a class="el" href="#a58d0dc825ac4d94daee28062423208e3" title="If successful, info about the last generated cut.">cut()</a>. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001569">Todo</a></b></dt><dd>(user): This is slow, 50% of run time on a2c1s1.pb.gz. Optimize! </dd></dl>
<p>Try IB before heuristic? This should be better except it can mess up the norm and the divisors.</p>
<p>We complement the term before trying the implied bound.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001570">Todo</a></b></dt><dd>(user): We assume that this is called with and without the option use_ib_before_heuristic, so that we can abort if no IB has been applied since then we will redo the computation. This is not really clean. </dd></dl>
<p>Our heuristic will try to generate a few different cuts, and we will keep the most violated one scaled by the l2 norm of the relevant position.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001571">Todo</a></b></dt><dd>(user): Experiment for the best value of this initial violation threshold. Note also that we use the l2 norm on the restricted position here. Maybe we should change that? On that note, the L2 norm usage seems a bit weird to me since it grows with the number of term in the cut. And often, we already have a good cut, and we make it stronger by adding extra terms that do not change its activity.</dd></dl>
<p>The discussion above only concern the best_scaled_violation initial value. The remainder_threshold allows to not consider cuts for which the final efficacity is clearly lower than 1e-3 (it is a bound, so we could generate cuts with a lower efficacity than this).</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001572">Todo</a></b></dt><dd>(user): If the rhs is small and close to zero, we might want to consider different way of complementing the variables. </dd></dl>
<p>There is no point trying twice the same divisor or a divisor that is too small. Note that we use a higher threshold than the remainder_threshold because we can boost the remainder thanks to our adjusting heuristic below and also because this allows to have cuts with a small range of coefficients.</p>
<dl class="section note"><dt>Note</dt><dd>because of the slacks, initial coeff are here too.</dd></dl>
<p>If we have too many divisor to try, restrict to the first ones which should correspond to the highest lp values.</p>
<dl class="section note"><dt>Note</dt><dd>most of the time is spend here since we call this function on many linear equation, and just a few of them have a good enough scaled violation. We can spend more time afterwards to tune the cut.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001573">Todo</a></b></dt><dd>(user): Avoid quadratic algorithm? Note that we are quadratic in relevant positions not the full cut size, but this is still too much on some problems. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>the function will abort right away if <a class="el" href="namespaceoperations__research_1_1sat.html#a83f714c395df7a814ed067125f567a0d">PositiveRemainder()</a> is not good enough, so it is quick for bad divisor.</dd></dl>
<p>Try best_divisor divided by small number.</p>
<p>Re try complementation on the transformed cut.</p>
<p>Temporary complement this variable.</p>
<p>keep the change.</p>
<p>Restore.</p>
<p>Adjust coefficients as computed by the best GetScaledViolation().</p>
<p>Create the base super-additive function f().</p>
<p>Look amongst all our possible function f() for one that dominate greedily our current best one. Note that we prefer lower scaling factor since that result in a cut with lower coefficients.</p>
<p>We only look at relevant position and ignore the other. Not sure this is the best approach.</p>
<dl class="section note"><dt>Note</dt><dd>the complexity seems high 100 * 2 * options.max_scaling, but this only run on cuts that are already efficient and the inner loop tend to abort quickly. I didn't see this code in the cpu profile so far.</dd></dl>
<p>Use implied bounds to "lift" Booleans into the cut. This should lead to stronger cuts even if the norms might be worse.</p>
<p>More complementation, but for the same f. If we can do that, it probably means our heuristics above are not great.</p>
<p>Complementing an entry gives: [a * X &lt;= b] -&gt; [-a * (diff - X) &lt;= b - a * diff]</p>
<p>We will compare what happen when we apply f: [f(b) - f(a) * lp(X)] -&gt; [f(b - a * diff) - f(-a) * (diff - lp(X))].</p>
<p>If lp(X) is zero, then the transformation is always worse. Because f(b - a * diff) &gt;= f(b) + f(-a) * diff by super-additivity.</p>
<p>However the larger is X, the better it gets since at diff, we have f(b) &gt;= f(b - a * diff) + f(a * diff) &gt;= f(b - a * diff) + f(a) * diff.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo001574">Todo</a></b></dt><dd>(user): It is still unclear if we have a * X + b * (1 - X) &lt;= rhs for a Boolean X, what is the best way to apply f and if we should merge the terms. If there is no other terms, best is probably f(rhs - a) * X + f(rhs - b) * (1 - X). </dd></dl>
<p>Avoid potential overflow here.</p>

<p class="definition">Definition at line <a class="el" href="cuts_8cc_source.html#l00785">785</a> of file <a class="el" href="cuts_8cc_source.html">cuts.cc</a>.</p>

</div>
</div>
<a id="a58d0dc825ac4d94daee28062423208e3" name="a58d0dc825ac4d94daee28062423208e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58d0dc825ac4d94daee28062423208e3">&#9670;&#160;</a></span>cut()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structoperations__research_1_1sat_1_1CutData.html">CutData</a> &amp; operations_research::sat::IntegerRoundingCutHelper::cut </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If successful, info about the last generated cut. </p>

<p class="definition">Definition at line <a class="el" href="cuts_8h_source.html#l00415">415</a> of file <a class="el" href="cuts_8h_source.html">cuts.h</a>.</p>

</div>
</div>
<a id="a60f3292cb1422998fb1f3cceb3bf4979" name="a60f3292cb1422998fb1f3cceb3bf4979"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60f3292cb1422998fb1f3cceb3bf4979">&#9670;&#160;</a></span>Info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string operations_research::sat::IntegerRoundingCutHelper::Info </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Single line of text that we append to the cut log line. </p>

<p class="definition">Definition at line <a class="el" href="cuts_8h_source.html#l00420">420</a> of file <a class="el" href="cuts_8h_source.html">cuts.h</a>.</p>

</div>
</div>
<a id="afaa0b7331e762ee55e778a96fd5b1da7" name="afaa0b7331e762ee55e778a96fd5b1da7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afaa0b7331e762ee55e778a96fd5b1da7">&#9670;&#160;</a></span>SetSharedStatistics()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void operations_research::sat::IntegerRoundingCutHelper::SetSharedStatistics </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classoperations__research_1_1sat_1_1SharedStatistics.html">SharedStatistics</a> *</td>          <td class="paramname"><span class="paramname"><em>stats</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cuts_8h_source.html#l00417">417</a> of file <a class="el" href="cuts_8h_source.html">cuts.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>ortools/sat/<a class="el" href="cuts_8h_source.html">cuts.h</a></li>
<li>ortools/sat/<a class="el" href="cuts_8cc_source.html">cuts.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceoperations__research.html">operations_research</a></li><li class="navelem"><a class="el" href="namespaceoperations__research_1_1sat.html">sat</a></li><li class="navelem"><a class="el" href="classoperations__research_1_1sat_1_1IntegerRoundingCutHelper.html">IntegerRoundingCutHelper</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
